import "@screens/mailBox/css/receiveMailScreen.css";
import TimeSortedList from "../../components/mailBox/timeSortedList";
import { useSortStore, SORT_OPTIONS, useMailStore } from "../../store";
import SenderGroupedList from "../../components/mailBox/senderGroupedList";
import MailPreviewContainer from "../../components/mailBox/mailPreviewContainer";
import MailDetail from "../../components/mailBox/mailDetail";
import MailDetailMax from "../../components/mailBox/mailDetailMax";
import { useEffect } from "react";

const ReceiveMailScreen = () => {
  const sortOption = useSortStore((state) => state.sortOption);
  const selectedGroup = useMailStore((state) => state.selectedGroup);
  const selectedMail = useMailStore((state) => state.selectedMail);
  const isExpanded = useMailStore((state) => state.isExpanded);
  const { receivedMails, fetchReceivedMails, status, error } = useMailStore();

  useEffect(() => {
    fetchReceivedMails();
  }, [fetchReceivedMails]);

  return (
    <div className="receiveMailScreen-container">
      {isExpanded ? (
        <MailDetailMax />
      ) : (
        <>
          {/* ì™¼ìª½: ë©”ì¼ ëª©ë¡ */}
          <div className="receiveMailScreen-list">
            {status === "loading" ? (
              <p>ğŸ“© ë©”ì¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            ) : error ? (
              <p>ì˜¤ë¥˜: {error}</p>
            ) : sortOption === SORT_OPTIONS.TIME ? (
              <TimeSortedList mails={receivedMails} />
            ) : (
              <SenderGroupedList />
            )}
          </div>

          {/* ì˜¤ë¥¸ìª½: ì„ íƒëœ í•­ëª©ì— ë”°ë¼ ë³€ê²½ */}
          <div className="receiveMailScreen-preview">
            {sortOption === SORT_OPTIONS.SENDER && selectedGroup.length > 0 ? (
              <MailPreviewContainer />
            ) : selectedMail ? (
              <MailDetail />
            ) : null}
          </div>
        </>
      )}
    </div>
  );
};

export default ReceiveMailScreen;
